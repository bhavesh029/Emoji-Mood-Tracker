service: emojiTracker-mw-scripts
frameworkVersion: '3'
configValidationMode: warn

provider:
  name: aws
  runtime: nodejs18.x
  stage: prod-india-lambda
  region: ap-south-1
  timeout: 30
  memorySize: 250
  iamManagedPolicies:
    - "arn:aws:iam::834534110091:policy/emojiTrackerMwProdIndiaLambdaPolicy"
    
  vpc:
    securityGroupIds:
     -  sg-09f69d552886a66f5
    subnetIds:
      - subnet-0e7a4d03f21a218ee
      - subnet-0c2db8d7bb3c10644

package:
  individually: true

functions:
  aggregation_script:
    handler: apps/mw-app/src/app/lambda-ratings-aggregation.handler
    events:
      - schedule:
          rate: cron(5 0 * * ? *)
          timezone: Asia/Kolkata

custom:
  dotenv:
     exclude:
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - AWS_SESSION_TOKEN
      - AWS_REGION
      
  webpack:
    webpackConfig: 'webpack.config.js' # Name of webpack configuration file
    includeModules: true # Node modules configuration for packaging
    excludeFiles: src/**/*.test.js
    packagerOptions:
      scripts:
        - npm uninstall *
        - npm install sequelize@6.29.0
 
plugins:
  - serverless-local-schedule
  - serverless-dotenv-plugin
  - serverless-webpack

